function __git_delete_branch_merged
# リモート追跡ブランチを更新
  git fetch -p

# 一度以上リモートにプッシュされたが、現在はリモートに存在しないブランチを取得
  set branches (for branch in (git for-each-ref --format '%(refname:short)' refs/heads/); 
      if not git show-ref --verify --quiet refs/remotes/origin/$branch;
          echo $branch; 
      end;
  end)

# 選択肢がない場合は終了
  if test (count $branches) -eq 0
      echo "削除対象のブランチはありません。"
      exit 0
  end

# インタラクティブな選択
  set selected_branches (for branch in $branches; echo "$branch"; end | fzf --multi)

# 削除を確認
  echo "以下のブランチを削除します:"
  for branch in $selected_branches
      echo $branch
  end

  echo -n "本当に削除しますか？ (y/N): "
  read -l confirm

  if test "$confirm" = "y"
      for branch in $selected_branches
          git branch -D (string trim -c "[]" $branch)
      end
      echo "ブランチが削除されました。"
  else
      echo "削除がキャンセルされました。"
  end
end
